<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0" />
		<title>Chat Room</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
		<style>
			* {
				box-sizing: border-box;
			}

			html,
			body {
				height: 100%;
				margin: 0;
			}

      .min-h-200px {
        min-height: 200px;
      }

      .min-vh-50 {
        min-height: 50vh;
      }

      .max-vh-100 {
        max-height: 100vh;
      }

      .max-vh-80 {
        max-height: 80vh;
      }

      .min-vh-50 {
        height: 50vh;
        min-height: 50vh;
      }

      .message {
        display: flex;
      }
      .message.message-from {
        justify-content: start;
      }
      .message.message-to {
        justify-content: end;
      }
      .message > .message-body {
        margin-top: auto;
        margin-bottom: auto;
        margin-left: 10px;
        position: relative;
        padding: 10px;
        border-radius: 10px;
      }
      .message.message-from > .message-body {
        background-color: #82ccdd;
      }
      .message.message-to > .message-body {
        background-color: #78e08f;
      }
      .message > .message-body > .message-footer {
        position: absolute;
        left: 0;
        bottom: -15px;
        color: rgba(42, 41, 41, 0.5);
        font-size: 10px;
      }
		</style>
	</head>
	<body>
		<div class="container-fluid min-vh-100 d-flex flex-column">
      <div class="row flex-grow-1">

				<div class="col-sm-2 d-none d-xl-block border border-dark-subtle">
						<h1 class="text-center">Members</h1>
				</div>

				<div class="col border border-dark-subtle">
						<div class="text-center">
              <h1><%= displayName %></h1>
              <small>Invite others using this link: /join?roomId=<%= roomId %></small>
            </div>
            <div class="container max-vh-100">
              <div class="row max-vh-100 justify-content-center">
                <div class="col-xl-6 col-lg-8 col-sm-12">
                  <div class="card min-h-200px max-vh-80 d-flex flex-column">
                    <!--<div class="card-body d-flex flex-column flex-nowrap align-items-start vh-50" style="overflow:scroll;">-->
                    <div class="card-body min-vh-50" style="overflow:scroll;">
                      <div class="message message-from"><div class="message-body">Hello!<span class="message-footer">Joe</span></div></div>
                      <div class="message message-to"><div class="message-body">Whats Up!<span class="message-footer">Matt</span></div></div>
                      <div class="message message-from"><div class="message-body">Hello!<span class="message-footer">Joe</span></div></div>
                      <div class="message message-to"><div class="message-body">Whats Up!<span class="message-footer">Matt</span></div></div>
                      <div class="message message-from"><div class="message-body">Hello!<span class="message-footer">Joe</span></div></div>
                      <div class="message message-to"><div class="message-body">Whats Up!<span class="message-footer">Matt</span></div></div>
                      <div class="message message-from"><div class="message-body">Hello!<span class="message-footer">Joe</span></div></div>
                      <div class="message message-to"><div class="message-body">Whats Up!<span class="message-footer">Matt</span></div></div>
                      <div class="message message-from"><div class="message-body">Hello!<span class="message-footer">Joe</span></div></div>
                      <div class="message message-to"><div class="message-body">Whats Up!<span class="message-footer">Matt</span></div></div>
                      <div class="message message-from"><div class="message-body">Hello!<span class="message-footer">Joe</span></div></div>
                      <div class="message message-to"><div class="message-body">Whats Up!<span class="message-footer">Matt</span></div></div>
                      <div class="message message-from"><div class="message-body">Hello!<span class="message-footer">Joe</span></div></div>
                      <div class="message message-to"><div class="message-body">Whats Up!<span class="message-footer">Matt</span></div></div>
                    </div>
                    <div class="card-footer">
      								<div class="input-group">
                        <textarea class="form-control custom-control" rows="3" style="resize: none"></textarea>
                        <button class="input-group-addon btn btn-lg btn-primary">Send</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>

          <!--
					<div class="row">
						<div class="card">
							<div class="card-body d-flex flex-column">
								<div class="message message-to">Hello, how can I assist you?</div>
								<div class="message message-to">Are you there? How can I assist you?</div>
								<div class="message message-from">Oh, I'm sorry! I need your password.</div>
								<div class="message message-to">Goodbye.</div>
							</div>
							<div class="card-footer">
								<div class="input-group">
									<textarea class="form-control custom-control bgc-lightgray" rows="8" style="resize: none"></textarea>
									<button class="input-group-addon btn btn-lg btn-primary w-20-pct">Send</button>
								</div>
							</div>
						</div>
					</div>
				</div>
      -->

				<!--
      <div class="col-2 h-100 p-0 border border-dark-subtle">
        <div class="row border-bottom border-dark-subtle" style="max-height: 50px;">
          <h1 class="text-center">Members</h1>
        </div>
        <div class="row">

        </div>
      </div>

      <div class="col-10 h-100 p-0 border border-dark-subtle">

        <div class="row border-bottom border-dark-subtle" style="max-height: 50px;">
          <h1 class="text-center">DISPLAY_NAME_PLACEHOLDER</h1>
        </div>

        <div class="row h-80">

        </div>
        
        <div class="row">
          <div class="col-12">
            <div class="input-group">
              <textarea class="form-control custom-control" rows="3" style="resize:none"></textarea>     
              <span class="input-group-addon btn btn-primary">Send</span>
            </div>
          </div>
        </div>

      </div>
      -->
		</div>
		<script>
			deleteAllCookies();
      const roomId = '<%- JSON.stringify(roomId) %>';
      const displayName = '<%- JSON.stringify(displayName) %>';
      const members = '<%- JSON.stringify(members) %>';

      const socket = new WebSocket("ws://localhost:3000");
      socket.onopen = (ws, event) => {
        console.log("socket open", {displayName,roomId, members});
      }

			function deleteAllCookies() {
				const cookies = document.cookie.split(";");

				for (let i = 0; i < cookies.length; i++) {
					const cookie = cookies[i];
					const eqPos = cookie.indexOf("=");
					const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
					document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;";
				}
			}
		</script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	</body>
</html>
