<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, minimum-scale=1.0" />
    <title>RTChat | Room</title>
    <link href="/public/bootstrap@5.3.3/css/bootstrap.min.css" rel="stylesheet" />
    <%- include("partials/bootstrap-icons.ejs") %>
    <link href="/public/rtchat/css/chat.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Toast alerts -->
    <div id="toast-container" class="toast-container top-0 end-0 p-2"></div>
    <!-- Modals -->
    <%- include("./partials/leave-room-confirmation-modal.ejs") %> <%- include("./partials/create-room-modal.ejs") %><%- include("./partials/join-room-modal.ejs", { nonce }) %>
    <!-- Navbar -->
    <header class="navbar navbar-expand-lg fixed-top bg-secondary-subtle">
      <nav class="container">
        <div class="me-auto">
          <span class="navbar-brand">RTChat</span>
        </div>
        <div class="mx-auto">
          <a class="navbar-icon d-inline-block d-lg-none" data-bs-toggle="offcanvas" data-bs-target="#members-offcanvas">
            <button class="btn btn-outline-secondary" type="button" title="View Members">
              <i class="bi bi-people"></i>
            </button>
          </a>
          <a class="navbar-icon d-inline-block d-lg-none">
            <button class="btn btn-outline-secondary" type="button" title="View Rooms" data-bs-toggle="offcanvas" data-bs-target="#rooms-offcanvas">
              <i class="bi bi-door-open"></i>
            </button>
          </a>
        </div>
        <div class="ms-auto">
          <a id="toggle-theme" class="navbar-icon" title="Toggle theme">
            <button class="btn btn-outline-secondary flex-fill">
              <svg id="dark-theme-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="d-none bi bi-moon" viewBox="0 0 16 16">
                <path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278M4.858 1.311A7.27 7.27 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.32 7.32 0 0 0 5.205-2.162q-.506.063-1.029.063c-4.61 0-8.343-3.714-8.343-8.29 0-1.167.242-2.278.681-3.286" />
              </svg>
              <svg id="light-theme-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sun-fill fs-3 d-none" viewBox="0 0 16 16">
                <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708" />
              </svg>
            </button>
          </a>
          <a class="navbar-icon" href="logout">
            <button class="btn btn-outline-secondary flex-fill" type="button" title="Logout">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-power" viewBox="0 0 16 16">
                <path d="M7.5 1v7h1V1z" />
                <path d="M3 8.812a5 5 0 0 1 2.578-4.375l-.485-.874A6 6 0 1 0 11 3.616l-.501.865A5 5 0 1 1 3 8.812" />
              </svg>
            </button>
          </a>
        </div>
      </nav>
    </header>
    <!-- MAIN CONTENT -->
    <div class="container-fluid h-100 d-flex flex-column" style="padding-top: 4em">
      <div class="row text-center">
        <div class="col">
          <h1><%= name %></h1>
        </div>
      </div>
      <!-- Content Row (main row) -->
      <div class="row g-0 flex-fill justify-content-center min-h-0">
        <div id="members-offcanvas" class="card col-xl-2 col-3 d-lg-flex flex-column h-lg-90pct min-h-0 overf-hide offcanvas-lg offcanvas-start">
          <div class="card-header d-flex flex-row display-6 text-center">
            <div class="flex-fill text-center">Members</div>
            <button type="button" class="btn btn-close btn-sm d-lg-none ms-auto" data-bs-dismiss="offcanvas" data-bs-target="#members-offcanvas"></button>
          </div>
          <div id="members-container" class="card-body overf-y-scroll p-0 m-1">
            <div id="loading-members-spinner" class="d-none d-flex mt-4 justify-content-center">
              <div class="spinner-border">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
            <ul id="members-list" class="list-group list-group-flush"></ul>
            <div id="direct-messages-drawer" class="drawer card">
              <div class="drawer-header card-header fs-3">
                <div class="flex-fill text-center">Direct Messages</div>
                <button id="close-direct-messages-drawer" type="button" class="btn btn-close btn-sm drawer-close-button"></button>
              </div>
              <div id="direct-messages-container" class="drawer-body card-body"></div>
              <div class="card-footer">
                <div class="row">
                  <div class="col-12 d-flex p-1">
                    <button id="close-dms-footer-btn" class="btn btn-outline-secondary flex-grow-1" type="button" title="Close Direct Messages">
                      <i class="bi bi-x-square"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <div class="row">
              <div class="col-12 d-flex p-1">
                <button id="open-direct-messages" class="btn btn-outline-secondary flex-grow-1" type="button" title="Direct Messages">
                  <i class="bi bi-chat-dots-fill"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
        <div class="card col-lg-6 offset-lg-0 col-md-10 offset-md-0 h-90pct overf-hide d-flex">
          <div class="card-header d-flex flex-row">
            <div id="chat-title" class="d-flex w-100 text-center justify-content-center align-items-center chat-title chat-title-no-room">Please join a room</div>
          </div>
          <div id="chat-display" class="card-body overf-y-scroll"></div>
          <div class="card-footer">
            <div class="input-group">
              <textarea id="chat-text-input" class="form-control custom-control" rows="3" style="resize: none"></textarea>
              <button id="send-chat-btn" class="input-group-addon btn btn-lg btn-primary">Send</button>
            </div>
          </div>
        </div>
        <div id="rooms-offcanvas" class="card col-xl-2 col-3 d-lg-flex flex-column h-lg-90pct min-h-0 overf-hide offcanvas-lg offcanvas-end">
          <div class="card-header d-flex flex-row display-6 text-center">
            <div class="flex-fill text-center">Rooms</div>
            <button type="button" class="btn btn-close btn-sm d-lg-none ms-auto" data-bs-dismiss="offcanvas" data-bs-target="#rooms-offcanvas"></button>
          </div>
          <div id="rooms-container" class="card-body overf-y-scroll p-0 m-1">
            <div id="loading-rooms-spinner" class="d-flex mt-4 justify-content-center">
              <div class="spinner-border">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          </div>
          <div class="card-footer">
            <div class="row">
              <div class="col-4 d-flex p-1">
                <button id="open-join-room-modal" class="btn btn-outline-secondary flex-grow-1" type="button" title="Join room">
                  <i class="bi bi-box-arrow-in-up-right"></i>
                </button>
              </div>
              <div class="col-4 d-flex p-1">
                <button id="leave-room-btn" class="btn btn-outline-danger flex-grow-1" type="button" title="Leave current room" disabled>
                  <i class="bi bi-box-arrow-down-left"></i>
                </button>
              </div>
              <div class="col-4 d-flex p-1">
                <button id="open-create-room-modal-btn" class="btn btn-outline-secondary flex-grow-1" type="button" title="Create room">
                  <i class="bi bi-folder-plus"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script nonce="<%= nonce %>">
      const USER_NAME = "<%= name %>";
      const USER_ID = "<%= id %>";
      const USER_EMAIL = "<%= email %>";
      const WEBSOCKET_URL = "<%= websocketUrl %>";
    </script>
    <script nonce="<%= nonce %>" src="/public/bootstrap@5.3.3/js/bootstrap.bundle.min.js" type="text/javascript"></script>
    <script nonce="<%= nonce %>" src="/public/rtchat/js/CustomAlert.js" type="text/javascript"></script>
    <script nonce="<%= nonce %>" src="/public/rtchat/js/addSpinnerToButton.js" type="text/javascript"></script>
    <script nonce="<%= nonce %>" src="/public/rtchat/js/theme.js" type="text/javascript"></script>
    <script nonce="<%= nonce %>" src="/public/rtchat/js/ws.js" type="text/javascript"></script>
    <script nonce="<%= nonce %>" src="/public/rtchat/js/chat.js" type="text/javascript"></script>
  </body>
</html>
